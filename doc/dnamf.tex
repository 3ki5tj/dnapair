\documentclass{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{bm}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{tikz}
\usepackage{hyperref}

\hypersetup{
    colorlinks,
    linkcolor={red!30!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}


\begin{document}



\newcommand{\vct}[1]{\mathbf{#1}}
\newcommand{\vx}{\vct{x}}
\newcommand{\vy}{\vct{y}}
\newcommand{\Z}{\mathcal{Z}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\Ham}{\mathcal{H}}
\newcommand{\W}{\mathcal{W}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\LL}{\mathcal{L}}
\newcommand{\var}{\mathrm{var}}
\newcommand{\com}{\mathrm{com}}

\newcommand{\llbra}{[\![}
\newcommand{\llket}{]\!]}

% annotation macros
\newcommand{\repl}[2]{{\color{gray} [#1] }{\color{blue} #2}}
\newcommand{\add}[1]{{\color{blue} #1}}
\newcommand{\del}[1]{{\color{gray} [#1]}}
\newcommand{\note}[1]{{\color{OliveGreen}\small [\textbf{Comment.} #1]}}





%\title{DNA mean force}
\author{ \vspace{-10ex} }
\date{ \vspace{-10ex} }


%\maketitle

%\abstract{
%}

%\tableofcontents



\section{Mean-forces}


%\subsection{General mean-force formula}
%
%
%First, let us review a general mean-force formula.
%%
%For a quantity $X(\mathbf r)$
%as a function of molecular configuration $\mathbf r$,
%the distribution of $X$ is given by
%$$
%\rho(X)
%=
%\int \delta(X(\mathbf r) - X) \, w(\mathbf r) \, d\mathbf r,
%$$
%where the distribution
%$$
%w(\mathbf r)
%=
%\frac{ \exp[ - \beta \, U(\mathbf r) ] }
%     { Z(\beta) }
%.
%$$
%The standard mean-force formula in this case is
%$$
%\frac{ \partial \ln \rho(X) }
%     { \partial X }
%=
%\left\langle
%\nabla \cdot
%  \left(
%    \frac{ \mathbf V }
%         { \mathbf V \cdot \nabla X }
%  \right)
%  +
%  \frac{ \beta \mathbf V \cdot \mathbf F }
%       { \mathbf V \cdot \nabla X }
%\right\rangle_X
%,
%$$
%where $\langle \dots \rangle_X$
%means the average under a fixed value $X(\mathbf r) = X$,
%and $\mathbf V$ is an arbitrary field of $\mathbf r$.
%
%This formula can be generalized to a two-dimension distribution,
%for
%$$
%\rho(X_1, X_2)
%=
%\int
%\delta(X_1(\mathbf r) - X_1) \,
%\delta(X_2(\mathbf r) - X_2) \,
%w(\mathbf r) \, d\mathbf r,
%$$
%we have
%$$
%\frac{ \partial \ln \rho(X_1, X_2) }
%     { \partial X_i }
%=
%\left\langle
%\nabla \cdot
%  \left(
%    \frac{ \mathbf V_i }
%         { \mathbf V_i \cdot \nabla X_i }
%  \right)
%  +
%  \frac{ \beta \mathbf V_i \cdot \mathbf F }
%       { \mathbf V_i \cdot \nabla X_i }
%\right\rangle_{X_1, X_2}
%,
%$$
%for $i = 1, 2$, as long as we can make sure
%\begin{equation}
%\mathbf V_1 \cdot \nabla X_2
%=
%\mathbf V_2 \cdot \nabla X_1
%= 0
%.
%\label{eq:ortho}
%\end{equation}
%
%
%
%Below, we will use this formula to derive
%the mean-forces along $R$ and $\Theta$
%of a pair of DNAs.


\subsection{Radial mean force}


%For the radial force between the $x$-separated two helices,
%we define their separation
%between the centers of mass
%$$
%R(\mathbf r) = X_+(\mathbf r) - X_-(\mathbf r)
%,
%$$
%where $+$ and $-$ are the labels of the two helices,
%and
%\begin{equation}
%X_s(\mathbf r)
%=
%\frac{ m_{s1} X_{s1} + \cdots + m_{sn} X_{sn} }
%     { M_s }
%,
%\label{eq:comx}
%\end{equation}
%where, $s = +$ or $-$,
%the total mass $M_s = m_{s1} + \cdots +m_{sn}$,
%and $n$ is the number of atoms on each helix.
%
%The gradient $\nabla X$ is
%$$
%\nabla R_{si}
%=
%\left( \frac{ \partial R } { \partial \mathbf r_{si} } \right)
%=
%\left(
%  s \, \frac{ m_{si} } { M_s } , 0, 0
%\right)
%,
%$$
%for the $i$th atom of helix $s$.
%%
%A convenient vector field is
%\begin{equation}
%  \left( \mathbf V_R \right)_{si}
%  =
%  (s \, M_s, 0, 0)
%  ,
%\end{equation}
%such that
%$\mathbf V_R \cdot \nabla R = \sum_{s, i} m_{si} \, s^2 = M_+ + M_- = 2 \, M_s$,
%and
%$$
%  \left( \frac{ \mathbf V_R } { \mathbf V_R \cdot \nabla R } \right)_{si}
%  =
%  \left( \frac s 2, 0, 0 \right)
%  ,
%  \qquad
%  \nabla \cdot
%  \left( \frac{ \mathbf V_R } { \mathbf V_R \cdot \nabla R } \right)_{si}
%  = 0.
%$$
%Besides,
%$$
%  \frac{ \mathbf V_R } { \mathbf V_R \cdot \nabla R } \cdot \mathbf F
%  =
%  \sum_{s, i} F_{six} \frac{ s } { 2 }
%  .
%$$
%So we get
$$
\beta \, f_{R}
=
\frac{ \partial \ln \rho(R, \Theta) }
     { \partial R }
=
\frac \beta 2
\left\langle
  \sum_{i = 1}^n F_{+ix}
  -
  \sum_{i = 1}^n F_{-ix}
\right\rangle_{R, \Theta}
.
$$


\subsection{Angular mean force}

%Next, consider the angular mean force.
%$$
%\Theta(\mathbf r) = \Theta_+(\mathbf r) - \Theta_-(\mathbf r)
%,
%$$
%where
%$$
%\Theta_s(\mathbf r)
%=
%\frac{ I_{s1} \theta_{s1} + \cdots + I_{sn} \theta_{sn} }
%     { I_s }
%,
%$$
%and
%$$
%\begin{aligned}
%I_{si}
%&=
%m_{si}
%\left[
%  (x_{si} - X_s)^2
%  +
%  (y_{si} - Y_s)^2
%\right],
%\\
%I_s
%&= \sum_{i = 1}^n I_{si},
%\\
%\theta_{si}
%&=
%\tan^{-1}
%\frac{ y_{si} - Y_s }
%     { x_{si} - X_s }
%,
%\end{aligned}
%$$
%with the $y$ coordinate of the center of mass, $Y_s$,
%defined similarly as by Eq. \eqref{eq:comx}.
%%
%Below, in deriving the mean force,
%we shall, however, treat $X_s$ and $Y_s$
%as fixed.
%
%Now since
%$$
%\nabla \theta_{si}
%=
%\frac{
%  \bigl(
%   -(y_{si} - Y_s),
%   x_{si} - X_s,
%   0
%  \bigr)
%}
%{ (x_{si} - X_s)^2 + (y_{si} - Y_s)^2 }
%,
%$$
%the gradient is
%$$
%\left( \nabla \Theta \right)_{si}
%=
%\frac{ s \, m_{si} }
%{ I_s }
%  \bigl(
%   -(y_{si} - Y_s),
%   x_{si} - X_s,
%   0
%  \bigr)
%,
%$$
%and we choose the conjugate field as
%\begin{equation}
%\left( \mathbf V_\Theta \right)_{si}
%=
%s \, I_s \,
%  \bigl(
%   -(y_{si} - Y_s),
%   x_{si} - X_s,
%   0
%  \bigr)
%.
%\end{equation}
%In this way,
%the orthogonality Eq. \eqref{eq:ortho}
%is satisfied.
%
%So $\mathbf V_\Theta \cdot \nabla \Theta = I_+ + I_- = 2 \, I_s$,
%and
%$$
%  \left( \frac{ \mathbf V_\Theta } { \mathbf V_\Theta \cdot \nabla \Theta } \right)_{si}
%  =
%  \frac s 2
%  \bigl(
%   -(y_{si} - Y_s),
%   x_{si} - X_s,
%   0
%  \bigr)
%  ,
%$$
%leading to
%$$
%  \nabla \cdot
%  \left( \frac{ \mathbf V_\Theta } { \mathbf V_\Theta \cdot \nabla \Theta } \right)_{si}
%  = 0.
%$$
%Besides,
%$$
%  \frac{ \mathbf V_\Theta }
%  { \mathbf V_\Theta \cdot \nabla \Theta } \cdot \mathbf F
%  =
%  \sum_{s, i} \tau_{siz} \frac{ s } { 2 }
%  ,
%$$
%where the torque $\tau_{siz}$ defined as
%$$
%\tau_{siz}
%=
%(x_{si} - X_s) F_{siy}
%-
%(y_{si} - Y_s) F_{six}
%.
%$$
%So we get
$$
\beta \, f_{\Theta}
=
\frac{ \partial \ln \rho(R, \Theta) }
     { \partial \Theta }
=
\beta
\left\langle
  \sum_{i = 1}^n \tau_{+iz}
\right\rangle_{R, \Theta}
.
$$



\section{Determining the two-dimensional PMF from the mean forces}


To determine the mean force $\phi_i$ on a few grid points $i$,
we will minimize the functional
$$
E
=
\frac 1 2
\sum_{(i, j)}
  w_{ij}
  \left[
  \phi_i - \phi_j
  +
    \frac{ f_{Ri} + f_{Rj} } { 2 } \Delta R_{ij}
       +
    \frac{ f_{\Theta i} + f_{\Theta j} } { 2 } \Delta \Theta_{ij}
  \right]^2
$$
where
$(i, j)$ denotes a nearest neighbor pair,
$w_{ij}$ is the inverse of the square error of mean-force integral
of the pair
\begin{align*}
  w_{ij}^{-1}
&=
  \mathrm{error}
  \left(
    \frac{ f_{Ri} + f_{Rj} } { 2 } \Delta R_{ij}
       +
    \frac{ f_{\Theta i} + f_{\Theta j} } { 2 } \Delta \Theta_{ij}
  \right)
\\
&=
  \left[
    \frac{ \var (f_{Ri}) } { N_i - 1 }
  + \frac{ \var (f_{Rj}) } { N_j - 1}
  \right]
  \, \frac{ \Delta R_{ij}^2 } { 4 }
  +
  \left[
    \frac{ \var (f_{\Theta i}) } { N_i - 1}
  + \frac{ \var (f_{\Theta j}) } { N_j - 1}
  \right]
  \, \frac{ \Delta \Theta_{ij}^2 } { 4 }
,
\end{align*}
Here
$N_i$ is the number of independent samples for the grid point $i$,
$\var (f)$ is the variance of $f$,
and we have assumed that different grid points and
different mean force components are independent.

Thus, to minimize the function, we need to set
$$
\frac{ \partial E } { \partial \phi_i }
=
0,
$$
%
which leads to
\begin{equation}
\sum_{j \mathrm{\; n.n. \; } i }
  w_{ij} ( \phi_j - \phi_i )
=
\sum_{j \mathrm{\; n.n. \; } i }
  \left[
  \tfrac { w_{ij} \, \Delta R_{ij} } 2
  (f_{Ri} + f_{Rj})
  +
  \tfrac { w_{ij} \, \Delta \Theta_{ij} } 2
  (f_{\Theta i} + f_{\Theta j})
  \right]
,
\label{eq:phieqs}
\end{equation}
where the sum is carried over the nearest neighbors of $i$.

However, these equations are not independent:
if we sum over $i$, we get $0$ on both sides.
%
So we need to supply an additional equation,
which is $\sum_i \phi_i = 0$.
%
By solving Eq. \eqref{eq:phieqs} and this additional equation,
we get the PMF, $\phi_i$.

\subsection{Error estimation}

Since Eq. \eqref{eq:phieqs} is linear,
we can rewrite it in matrix form as
\begin{equation*}
\mathbf W \, \pmb\phi = \mathbf A \, \mathbf f_R + \mathbf B \, \mathbf f_\Theta,
\end{equation*}
where
\begin{align*}
  W_{ij}
  &=
  w_{ij} - \delta_{ij} \sum_k w_{ik}
  ,
  \\
  A_{ij}
  &=
  w_{ij} \frac{ \Delta R_{ij} } { 2 }
  +
  \delta_{ij}
  \sum_{k \mathrm{\; n.n. \; } i }
  w_{ik} \frac{ \Delta R_{ik} } { 2 }
  ,
  \\
  B_{ij}
  &=
  w_{ij} \frac{ \Delta \Theta_{ij} } { 2 }
  +
  \delta_{ij}
  \sum_{k \mathrm{\; n.n. \; } i }
  w_{ik} \frac{ \Delta \Theta_{ik} } { 2 }
  .
\end{align*}
If $j$ is neither a nearest neighbor of $i$, or $i$ itself,
the matrix elements are zeros in the above.
%
The last rows of $\mathbf W$, $\mathbf A$ and $\mathbf B$
should be modified to
$(1, \dots, 1)$, $(0, \dots, 0)$, and $0, \dots, 0)$,
respectively,
according to the above discussion.




Then, the solution is
\begin{equation}
\pmb\phi = \mathbf W^{-1} \, ( \mathbf A \, \mathbf f_R + \mathbf B \, \mathbf f_\Theta ),
\label{eq:phif}
\end{equation}
and the covariance matrix is given by
\begin{equation}
  \left\langle
    \pmb\phi \, \pmb\phi^T
  \right\rangle
  =
  \mathbf W^{-1} \,
  \bigl(
    \mathbf A \, \langle \mathbf f_R \, \mathbf f_R^T \rangle \, \mathbf A^T
    +
    \mathbf B \, \langle \mathbf f_\Theta \, \mathbf f_\Theta^T \rangle \, \mathbf B^T
  \bigr) \,
  (\mathbf W^{-1})^T
  ,
\label{eq:phierr}
\end{equation}
where
$\left\langle \mathbf f_R \, \mathbf f_R^T \right\rangle$
and
$\left\langle \mathbf f_\Theta \, \mathbf f_\Theta^T \right\rangle$
are diagonal matrices with the $i$th diagonal element given by
$\var(f_{R i})/(N_i - 1)$ and
$\var(f_{\Theta i})/(N_i - 1)$, respectively.
%
Equation \eqref{eq:phierr} provides a means of computing the error:
the standard deviation of $\phi_i$
is given by square root of the $i$th diagonal element
of $\left\langle \pmb\phi \, \pmb\phi^T \right\rangle$.



%\bibliographystyle{plain}
%\bibliography{simul}

\end{document}
